language: generic
sudo: required
services:
  - docker
branches:
  only:
    - master
cache:
  directories:
    - $HOME/$TRAVIS_BUILD_ID
env:
  global:
    - DOCKER_IMAGE='cerner/terra-clinical'
    - TAG="${TRAVIS_PULL_REQUEST_SHA:=latest}"
before_install:
  - rsync -an $HOME/$TRAVIS_BUILD_ID .
before_cache:
  - rsync . $HOME/$TRAVIS_BUILD_ID
jobs:
  include:
    - stage: build
      before_install: true
      script: travis_wait docker-compose run test-ci npm install
    - stage: ls
      script: travis_wait docker-compose run test-ci /bin/ls -al
    # - stage: danger lint and jest
    #   script: "travis_wait docker-compose run -e DANGER_GITHUB_API_TOKEN=$DANGER_GITHUB_API_TOKEN -e TRAVIS=$TRAVIS -e CI=$CI -e HAS_JOSH_K_SEAL_OF_APPROVAL=$HAS_JOSH_K_SEAL_OF_APPROVAL -e TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST -e TRAVIS_REPO_SLUG=$TRAVIS_REPO_SLUG test-ci bash -c 'npm run danger && npm run lint && npm run jest'"
    # - stage: compile - default theme
    #   script: travis_wait docker-compose run test-ci npm run compile:prod
    # - stage: wdio - default theme
    #   name: tiny
    #   script: travis_wait docker-compose run test-ci npm run wdio -- --formFactors ['tiny']
    # - script: travis_wait docker-compose run test-ci npm run wdio -- --formFactors ['small']
    #   name: small
    # - script: travis_wait docker-compose run test-ci npm run wdio -- --formFactors ['medium']
    #   name: medium
    # - script: travis_wait docker-compose run test-ci npm run wdio -- --formFactors ['large']
    #   name: large
    # - script: travis_wait docker-compose run test-ci npm run wdio -- --formFactors ['enormous']
    #   name: enormous

stages:
  - build
  - ls
  # - danger lint and jest
  # - compile - default theme
  # - wdio - default theme
