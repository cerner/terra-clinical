language: generic
sudo: required
services:
  - docker
branches:
  only:
    - master
cache:
  directories:
    - $HOME/$TRAVIS_BUILD_ID
env:
  global:
    - DOCKER_IMAGE='cerner/terra-clinical'
    - TAG="${TRAVIS_PULL_REQUEST_SHA:=latest}"
jobs:
  include:
    - stage: build
      script:
        - travis_wait docker-compose build test-ci
        - travis_wait docker-compose --verbose pull standalone-chrome
    - stage: print!
      script:
        - "travis_wait docker-compose run ls -al"
    - stage: clean up cache
      script:
        - sudo chown -R travis:travis $HOME/docker
        - 'rm -f $HOME/$TRAVIS_BUILD_ID'
stages:
  - build
  - danger lint and jest
  - wdio - default theme
  - wdio - fusion theme
  - name: deploy
    if: type != pull_request
  - clean up cache
